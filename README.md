# 卷积神经网络可视化项目说明

## 一、概述

本项目基于Python和C++实现了一个卷积神经网络的可视化，该卷积网络是我训练的一个C9大学校徽分类器。

我为什么想做这个项目？了解到国外有功能非常酷的神经网络可视化网站，例如<https://poloclub.github.io/cnn-explainer>（CNN）以及 <https://playground.tensorflow.org>（全连接网络）。因此，我决定训练一个C9大学校徽分类器的卷积神经网络，然后再把这个神经网络模型可视化出来，目的是想看清楚一张图被卷积网络识别为某个学校校徽的过程。


## 二、关键实现技术

#### 神经网络：采用pytorch框架

- **数据集**：在urongda网站上下载9所大学的校徽图片，使用脚本进行图像处理（缩放，旋转，对比度，亮度，饱和度，高斯模糊，随机JPEG压缩噪声），每类从1张生成200张，按7：1.5：1.5的比例划分训练集、验证集和测试集。

- **网络结构**：1\*64\*64灰度图输入->conv1~conv4四个卷积块->全局平均池化展平层->9类输出

- **训练参数**：batch=64，epoch=80，lr=0.001。正向传播推断时加上了RGB转灰度与缩放补齐到64\*64的前置图像处理，如果上传的图片不是64\*64灰度图也可以支持。

#### C++渲染库：SFML+ImGui


## 三、系统功能与架构

**功能说明**：首先显示网络整体结构，当鼠标移动到对应区域上时可以看到详细说明。对于四个卷积块（conv1~4），可以点击按钮查看卷积块内部的详细层级结构。对于卷积层，可以通过卷积动画查看每一张输入图片在各个处理阶段被网络抽象出的特征图。

**数据流**：
- **模型参数权重数据**：当模型训练好后，将acc最高的一次的权重数据存储在badge9\_best.pth中。然后用python脚本调用pytorch的库函数从该文件中加载model，再把model中各个参数与可视化热点对应起来，最后把参数结构信息写进json文件，把参数数值（二进制）写进bin文件（每个卷积层的输入都存为一个bin文件，bin1~4）。C++可视化端再根据json文件里面书写的参数结构信息解析bin文件中的参数数值。

- **卷积动画显示的图片数据**：从测试集里面加载一张图片，进行前向传播时保存每次卷积后的结果为bin1~4文件，当调用显示动画功能时，C++端从这4个bin文件中对应的那一个bin文件中提取数据。



## 四、部署方式

* **前提** ：已安装 Docker（Windows 需开启 WSL2 后端）

* 环境已打包成镜像cnn-sfml-final-latest，无需本地安装依赖。
下载 Release 里的 tar 或用 docker pull 拉取后一键运行即可。







